{"ast":null,"code":"\"use strict\";\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\n\nvar SERVICE_UNAVAILABLE = neo4j_driver_core_1.error.SERVICE_UNAVAILABLE,\n    SESSION_EXPIRED = neo4j_driver_core_1.error.SESSION_EXPIRED;\n\nvar ConnectionErrorHandler =\n/** @class */\nfunction () {\n  function ConnectionErrorHandler(errorCode, handleUnavailability, handleWriteFailure, handleAuthorizationExpired) {\n    this._errorCode = errorCode;\n    this._handleUnavailability = handleUnavailability || noOpHandler;\n    this._handleWriteFailure = handleWriteFailure || noOpHandler;\n    this._handleAuthorizationExpired = handleAuthorizationExpired || noOpHandler;\n  }\n\n  ConnectionErrorHandler.create = function (_a) {\n    var errorCode = _a.errorCode,\n        handleUnavailability = _a.handleUnavailability,\n        handleWriteFailure = _a.handleWriteFailure,\n        handleAuthorizationExpired = _a.handleAuthorizationExpired;\n    return new ConnectionErrorHandler(errorCode, handleUnavailability, handleWriteFailure, handleAuthorizationExpired);\n  };\n  /**\n   * Error code to use for network errors.\n   * @return {string} the error code.\n   */\n\n\n  ConnectionErrorHandler.prototype.errorCode = function () {\n    return this._errorCode;\n  };\n  /**\n   * Handle and transform the error.\n   * @param {Neo4jError} error the original error.\n   * @param {ServerAddress} address the address of the connection where the error happened.\n   * @return {Neo4jError} new error that should be propagated to the user.\n   */\n\n\n  ConnectionErrorHandler.prototype.handleAndTransformError = function (error, address) {\n    if (isAutorizationExpiredError(error)) {\n      return this._handleAuthorizationExpired(error, address);\n    }\n\n    if (isAvailabilityError(error)) {\n      return this._handleUnavailability(error, address);\n    }\n\n    if (isFailureToWrite(error)) {\n      return this._handleWriteFailure(error, address);\n    }\n\n    return error;\n  };\n\n  return ConnectionErrorHandler;\n}();\n\nexports.default = ConnectionErrorHandler;\n\nfunction isAutorizationExpiredError(error) {\n  return error && (error.code === 'Neo.ClientError.Security.AuthorizationExpired' || error.code === 'Neo.ClientError.Security.TokenExpired');\n}\n\nfunction isAvailabilityError(error) {\n  if (error) {\n    return error.code === SESSION_EXPIRED || error.code === SERVICE_UNAVAILABLE || error.code === 'Neo.TransientError.General.DatabaseUnavailable';\n  }\n\n  return false;\n}\n\nfunction isFailureToWrite(error) {\n  if (error) {\n    return error.code === 'Neo.ClientError.Cluster.NotALeader' || error.code === 'Neo.ClientError.General.ForbiddenOnReadOnlyDatabase';\n  }\n\n  return false;\n}\n\nfunction noOpHandler(error) {\n  return error;\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","neo4j_driver_core_1","require","SERVICE_UNAVAILABLE","error","SESSION_EXPIRED","ConnectionErrorHandler","errorCode","handleUnavailability","handleWriteFailure","handleAuthorizationExpired","_errorCode","_handleUnavailability","noOpHandler","_handleWriteFailure","_handleAuthorizationExpired","create","_a","prototype","handleAndTransformError","address","isAutorizationExpiredError","isAvailabilityError","isFailureToWrite","default","code"],"sources":["/Users/zack/src/gene3/node_modules/neo4j-driver-bolt-connection/lib/connection/connection-error-handler.js"],"sourcesContent":["\"use strict\";\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\nvar SERVICE_UNAVAILABLE = neo4j_driver_core_1.error.SERVICE_UNAVAILABLE, SESSION_EXPIRED = neo4j_driver_core_1.error.SESSION_EXPIRED;\nvar ConnectionErrorHandler = /** @class */ (function () {\n    function ConnectionErrorHandler(errorCode, handleUnavailability, handleWriteFailure, handleAuthorizationExpired) {\n        this._errorCode = errorCode;\n        this._handleUnavailability = handleUnavailability || noOpHandler;\n        this._handleWriteFailure = handleWriteFailure || noOpHandler;\n        this._handleAuthorizationExpired = handleAuthorizationExpired || noOpHandler;\n    }\n    ConnectionErrorHandler.create = function (_a) {\n        var errorCode = _a.errorCode, handleUnavailability = _a.handleUnavailability, handleWriteFailure = _a.handleWriteFailure, handleAuthorizationExpired = _a.handleAuthorizationExpired;\n        return new ConnectionErrorHandler(errorCode, handleUnavailability, handleWriteFailure, handleAuthorizationExpired);\n    };\n    /**\n     * Error code to use for network errors.\n     * @return {string} the error code.\n     */\n    ConnectionErrorHandler.prototype.errorCode = function () {\n        return this._errorCode;\n    };\n    /**\n     * Handle and transform the error.\n     * @param {Neo4jError} error the original error.\n     * @param {ServerAddress} address the address of the connection where the error happened.\n     * @return {Neo4jError} new error that should be propagated to the user.\n     */\n    ConnectionErrorHandler.prototype.handleAndTransformError = function (error, address) {\n        if (isAutorizationExpiredError(error)) {\n            return this._handleAuthorizationExpired(error, address);\n        }\n        if (isAvailabilityError(error)) {\n            return this._handleUnavailability(error, address);\n        }\n        if (isFailureToWrite(error)) {\n            return this._handleWriteFailure(error, address);\n        }\n        return error;\n    };\n    return ConnectionErrorHandler;\n}());\nexports.default = ConnectionErrorHandler;\nfunction isAutorizationExpiredError(error) {\n    return error && (error.code === 'Neo.ClientError.Security.AuthorizationExpired' ||\n        error.code === 'Neo.ClientError.Security.TokenExpired');\n}\nfunction isAvailabilityError(error) {\n    if (error) {\n        return (error.code === SESSION_EXPIRED ||\n            error.code === SERVICE_UNAVAILABLE ||\n            error.code === 'Neo.TransientError.General.DatabaseUnavailable');\n    }\n    return false;\n}\nfunction isFailureToWrite(error) {\n    if (error) {\n        return (error.code === 'Neo.ClientError.Cluster.NotALeader' ||\n            error.code === 'Neo.ClientError.General.ForbiddenOnReadOnlyDatabase');\n    }\n    return false;\n}\nfunction noOpHandler(error) {\n    return error;\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAIC,mBAAmB,GAAGC,OAAO,CAAC,mBAAD,CAAjC;;AACA,IAAIC,mBAAmB,GAAGF,mBAAmB,CAACG,KAApB,CAA0BD,mBAApD;AAAA,IAAyEE,eAAe,GAAGJ,mBAAmB,CAACG,KAApB,CAA0BC,eAArH;;AACA,IAAIC,sBAAsB;AAAG;AAAe,YAAY;EACpD,SAASA,sBAAT,CAAgCC,SAAhC,EAA2CC,oBAA3C,EAAiEC,kBAAjE,EAAqFC,0BAArF,EAAiH;IAC7G,KAAKC,UAAL,GAAkBJ,SAAlB;IACA,KAAKK,qBAAL,GAA6BJ,oBAAoB,IAAIK,WAArD;IACA,KAAKC,mBAAL,GAA2BL,kBAAkB,IAAII,WAAjD;IACA,KAAKE,2BAAL,GAAmCL,0BAA0B,IAAIG,WAAjE;EACH;;EACDP,sBAAsB,CAACU,MAAvB,GAAgC,UAAUC,EAAV,EAAc;IAC1C,IAAIV,SAAS,GAAGU,EAAE,CAACV,SAAnB;IAAA,IAA8BC,oBAAoB,GAAGS,EAAE,CAACT,oBAAxD;IAAA,IAA8EC,kBAAkB,GAAGQ,EAAE,CAACR,kBAAtG;IAAA,IAA0HC,0BAA0B,GAAGO,EAAE,CAACP,0BAA1J;IACA,OAAO,IAAIJ,sBAAJ,CAA2BC,SAA3B,EAAsCC,oBAAtC,EAA4DC,kBAA5D,EAAgFC,0BAAhF,CAAP;EACH,CAHD;EAIA;AACJ;AACA;AACA;;;EACIJ,sBAAsB,CAACY,SAAvB,CAAiCX,SAAjC,GAA6C,YAAY;IACrD,OAAO,KAAKI,UAAZ;EACH,CAFD;EAGA;AACJ;AACA;AACA;AACA;AACA;;;EACIL,sBAAsB,CAACY,SAAvB,CAAiCC,uBAAjC,GAA2D,UAAUf,KAAV,EAAiBgB,OAAjB,EAA0B;IACjF,IAAIC,0BAA0B,CAACjB,KAAD,CAA9B,EAAuC;MACnC,OAAO,KAAKW,2BAAL,CAAiCX,KAAjC,EAAwCgB,OAAxC,CAAP;IACH;;IACD,IAAIE,mBAAmB,CAAClB,KAAD,CAAvB,EAAgC;MAC5B,OAAO,KAAKQ,qBAAL,CAA2BR,KAA3B,EAAkCgB,OAAlC,CAAP;IACH;;IACD,IAAIG,gBAAgB,CAACnB,KAAD,CAApB,EAA6B;MACzB,OAAO,KAAKU,mBAAL,CAAyBV,KAAzB,EAAgCgB,OAAhC,CAAP;IACH;;IACD,OAAOhB,KAAP;EACH,CAXD;;EAYA,OAAOE,sBAAP;AACH,CArC2C,EAA5C;;AAsCAP,OAAO,CAACyB,OAAR,GAAkBlB,sBAAlB;;AACA,SAASe,0BAAT,CAAoCjB,KAApC,EAA2C;EACvC,OAAOA,KAAK,KAAKA,KAAK,CAACqB,IAAN,KAAe,+CAAf,IACbrB,KAAK,CAACqB,IAAN,KAAe,uCADP,CAAZ;AAEH;;AACD,SAASH,mBAAT,CAA6BlB,KAA7B,EAAoC;EAChC,IAAIA,KAAJ,EAAW;IACP,OAAQA,KAAK,CAACqB,IAAN,KAAepB,eAAf,IACJD,KAAK,CAACqB,IAAN,KAAetB,mBADX,IAEJC,KAAK,CAACqB,IAAN,KAAe,gDAFnB;EAGH;;EACD,OAAO,KAAP;AACH;;AACD,SAASF,gBAAT,CAA0BnB,KAA1B,EAAiC;EAC7B,IAAIA,KAAJ,EAAW;IACP,OAAQA,KAAK,CAACqB,IAAN,KAAe,oCAAf,IACJrB,KAAK,CAACqB,IAAN,KAAe,qDADnB;EAEH;;EACD,OAAO,KAAP;AACH;;AACD,SAASZ,WAAT,CAAqBT,KAArB,EAA4B;EACxB,OAAOA,KAAP;AACH"},"metadata":{},"sourceType":"script"}