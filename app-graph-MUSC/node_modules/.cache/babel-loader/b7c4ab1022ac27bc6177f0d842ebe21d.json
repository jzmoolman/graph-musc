{"ast":null,"code":"import { binarytree } from \"d3-binarytree\";\nimport { quadtree } from \"d3-quadtree\";\nimport { octree } from \"d3-octree\";\nimport constant from \"./constant.js\";\nimport jiggle from \"./jiggle.js\";\n\nfunction x(d) {\n  return d.x + d.vx;\n}\n\nfunction y(d) {\n  return d.y + d.vy;\n}\n\nfunction z(d) {\n  return d.z + d.vz;\n}\n\nexport default function (radius) {\n  var nodes,\n      nDim,\n      radii,\n      random,\n      strength = 1,\n      iterations = 1;\n  if (typeof radius !== \"function\") radius = constant(radius == null ? 1 : +radius);\n\n  function force() {\n    var i,\n        n = nodes.length,\n        tree,\n        node,\n        xi,\n        yi,\n        zi,\n        ri,\n        ri2;\n\n    for (var k = 0; k < iterations; ++k) {\n      tree = (nDim === 1 ? binarytree(nodes, x) : nDim === 2 ? quadtree(nodes, x, y) : nDim === 3 ? octree(nodes, x, y, z) : null).visitAfter(prepare);\n\n      for (i = 0; i < n; ++i) {\n        node = nodes[i];\n        ri = radii[node.index], ri2 = ri * ri;\n        xi = node.x + node.vx;\n\n        if (nDim > 1) {\n          yi = node.y + node.vy;\n        }\n\n        if (nDim > 2) {\n          zi = node.z + node.vz;\n        }\n\n        tree.visit(apply);\n      }\n    }\n\n    function apply(treeNode, arg1, arg2, arg3, arg4, arg5, arg6) {\n      var args = [arg1, arg2, arg3, arg4, arg5, arg6];\n      var x0 = args[0],\n          y0 = args[1],\n          z0 = args[2],\n          x1 = args[nDim],\n          y1 = args[nDim + 1],\n          z1 = args[nDim + 2];\n      var data = treeNode.data,\n          rj = treeNode.r,\n          r = ri + rj;\n\n      if (data) {\n        if (data.index > node.index) {\n          var x = xi - data.x - data.vx,\n              y = nDim > 1 ? yi - data.y - data.vy : 0,\n              z = nDim > 2 ? zi - data.z - data.vz : 0,\n              l = x * x + y * y + z * z;\n\n          if (l < r * r) {\n            if (x === 0) x = jiggle(random), l += x * x;\n            if (nDim > 1 && y === 0) y = jiggle(random), l += y * y;\n            if (nDim > 2 && z === 0) z = jiggle(random), l += z * z;\n            l = (r - (l = Math.sqrt(l))) / l * strength;\n            node.vx += (x *= l) * (r = (rj *= rj) / (ri2 + rj));\n\n            if (nDim > 1) {\n              node.vy += (y *= l) * r;\n            }\n\n            if (nDim > 2) {\n              node.vz += (z *= l) * r;\n            }\n\n            data.vx -= x * (r = 1 - r);\n\n            if (nDim > 1) {\n              data.vy -= y * r;\n            }\n\n            if (nDim > 2) {\n              data.vz -= z * r;\n            }\n          }\n        }\n\n        return;\n      }\n\n      return x0 > xi + r || x1 < xi - r || nDim > 1 && (y0 > yi + r || y1 < yi - r) || nDim > 2 && (z0 > zi + r || z1 < zi - r);\n    }\n  }\n\n  function prepare(treeNode) {\n    if (treeNode.data) return treeNode.r = radii[treeNode.data.index];\n\n    for (var i = treeNode.r = 0; i < Math.pow(2, nDim); ++i) {\n      if (treeNode[i] && treeNode[i].r > treeNode.r) {\n        treeNode.r = treeNode[i].r;\n      }\n    }\n  }\n\n  function initialize() {\n    if (!nodes) return;\n    var i,\n        n = nodes.length,\n        node;\n    radii = new Array(n);\n\n    for (i = 0; i < n; ++i) node = nodes[i], radii[node.index] = +radius(node, i, nodes);\n  }\n\n  force.initialize = function (_nodes) {\n    nodes = _nodes;\n\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    random = args.find(arg => typeof arg === 'function') || Math.random;\n    nDim = args.find(arg => [1, 2, 3].includes(arg)) || 2;\n    initialize();\n  };\n\n  force.iterations = function (_) {\n    return arguments.length ? (iterations = +_, force) : iterations;\n  };\n\n  force.strength = function (_) {\n    return arguments.length ? (strength = +_, force) : strength;\n  };\n\n  force.radius = function (_) {\n    return arguments.length ? (radius = typeof _ === \"function\" ? _ : constant(+_), initialize(), force) : radius;\n  };\n\n  return force;\n}","map":{"version":3,"names":["binarytree","quadtree","octree","constant","jiggle","x","d","vx","y","vy","z","vz","radius","nodes","nDim","radii","random","strength","iterations","force","i","n","length","tree","node","xi","yi","zi","ri","ri2","k","visitAfter","prepare","index","visit","apply","treeNode","arg1","arg2","arg3","arg4","arg5","arg6","args","x0","y0","z0","x1","y1","z1","data","rj","r","l","Math","sqrt","pow","initialize","Array","_nodes","find","arg","includes","_","arguments"],"sources":["/Users/zack/src/gene-graph-MUSC/node_modules/d3-force-3d/src/collide.js"],"sourcesContent":["import {binarytree} from \"d3-binarytree\";\nimport {quadtree} from \"d3-quadtree\";\nimport {octree} from \"d3-octree\";\nimport constant from \"./constant.js\";\nimport jiggle from \"./jiggle.js\";\n\nfunction x(d) {\n  return d.x + d.vx;\n}\n\nfunction y(d) {\n  return d.y + d.vy;\n}\n\nfunction z(d) {\n  return d.z + d.vz;\n}\n\nexport default function(radius) {\n  var nodes,\n      nDim,\n      radii,\n      random,\n      strength = 1,\n      iterations = 1;\n\n  if (typeof radius !== \"function\") radius = constant(radius == null ? 1 : +radius);\n\n  function force() {\n    var i, n = nodes.length,\n        tree,\n        node,\n        xi,\n        yi,\n        zi,\n        ri,\n        ri2;\n\n    for (var k = 0; k < iterations; ++k) {\n      tree =\n          (nDim === 1 ? binarytree(nodes, x)\n          :(nDim === 2 ? quadtree(nodes, x, y)\n          :(nDim === 3 ? octree(nodes, x, y, z)\n          :null\n      ))).visitAfter(prepare);\n\n      for (i = 0; i < n; ++i) {\n        node = nodes[i];\n        ri = radii[node.index], ri2 = ri * ri;\n        xi = node.x + node.vx;\n        if (nDim > 1) { yi = node.y + node.vy; }\n        if (nDim > 2) { zi = node.z + node.vz; }\n        tree.visit(apply);\n      }\n    }\n\n    function apply(treeNode, arg1, arg2, arg3, arg4, arg5, arg6) {\n      var args = [arg1, arg2, arg3, arg4, arg5, arg6];\n      var x0 = args[0],\n          y0 = args[1],\n          z0 = args[2],\n          x1 = args[nDim],\n          y1 = args[nDim+1],\n          z1 = args[nDim+2];\n\n      var data = treeNode.data, rj = treeNode.r, r = ri + rj;\n      if (data) {\n        if (data.index > node.index) {\n          var x = xi - data.x - data.vx,\n              y = (nDim > 1 ? yi - data.y - data.vy : 0),\n              z = (nDim > 2 ? zi - data.z - data.vz : 0),\n              l = x * x + y * y + z * z;\n          if (l < r * r) {\n            if (x === 0) x = jiggle(random), l += x * x;\n            if (nDim > 1 && y === 0) y = jiggle(random), l += y * y;\n            if (nDim > 2 && z === 0) z = jiggle(random), l += z * z;\n            l = (r - (l = Math.sqrt(l))) / l * strength;\n\n            node.vx += (x *= l) * (r = (rj *= rj) / (ri2 + rj));\n            if (nDim > 1) { node.vy += (y *= l) * r; }\n            if (nDim > 2) { node.vz += (z *= l) * r; }\n\n            data.vx -= x * (r = 1 - r);\n            if (nDim > 1) { data.vy -= y * r; }\n            if (nDim > 2) { data.vz -= z * r; }\n          }\n        }\n        return;\n      }\n      return x0 > xi + r || x1 < xi - r\n          || (nDim > 1 && (y0 > yi + r || y1 < yi - r))\n          || (nDim > 2 && (z0 > zi + r || z1 < zi - r));\n    }\n  }\n\n  function prepare(treeNode) {\n    if (treeNode.data) return treeNode.r = radii[treeNode.data.index];\n    for (var i = treeNode.r = 0; i < Math.pow(2, nDim); ++i) {\n      if (treeNode[i] && treeNode[i].r > treeNode.r) {\n        treeNode.r = treeNode[i].r;\n      }\n    }\n  }\n\n  function initialize() {\n    if (!nodes) return;\n    var i, n = nodes.length, node;\n    radii = new Array(n);\n    for (i = 0; i < n; ++i) node = nodes[i], radii[node.index] = +radius(node, i, nodes);\n  }\n\n  force.initialize = function(_nodes, ...args) {\n    nodes = _nodes;\n    random = args.find(arg => typeof arg === 'function') || Math.random;\n    nDim = args.find(arg => [1, 2, 3].includes(arg)) || 2;\n    initialize();\n  };\n\n  force.iterations = function(_) {\n    return arguments.length ? (iterations = +_, force) : iterations;\n  };\n\n  force.strength = function(_) {\n    return arguments.length ? (strength = +_, force) : strength;\n  };\n\n  force.radius = function(_) {\n    return arguments.length ? (radius = typeof _ === \"function\" ? _ : constant(+_), initialize(), force) : radius;\n  };\n\n  return force;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}