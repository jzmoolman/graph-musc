{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar bolt_protocol_util_1 = require(\"./bolt-protocol-util\");\n\nvar packstream_1 = require(\"../packstream\");\n\nvar request_message_1 = __importDefault(require(\"./request-message\"));\n\nvar stream_observers_1 = require(\"./stream-observers\");\n\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\n\nvar Bookmark = neo4j_driver_core_1.internal.bookmark.Bookmark,\n    _a = neo4j_driver_core_1.internal.constants,\n    ACCESS_MODE_WRITE = _a.ACCESS_MODE_WRITE,\n    BOLT_PROTOCOL_V1 = _a.BOLT_PROTOCOL_V1,\n    Logger = neo4j_driver_core_1.internal.logger.Logger,\n    TxConfig = neo4j_driver_core_1.internal.txConfig.TxConfig;\n\nvar BoltProtocol =\n/** @class */\nfunction () {\n  /**\n   * @callback CreateResponseHandler Creates the response handler\n   * @param {BoltProtocol} protocol The bolt protocol\n   * @returns {ResponseHandler} The response handler\n   */\n\n  /**\n   * @callback OnProtocolError Handles protocol error\n   * @param {string} error The description\n   */\n\n  /**\n   * @constructor\n   * @param {Object} server the server informatio.\n   * @param {Chunker} chunker the chunker.\n   * @param {Object} packstreamConfig Packstream configuration\n   * @param {boolean} packstreamConfig.disableLosslessIntegers if this connection should convert all received integers to native JS numbers.\n   * @param {boolean} packstreamConfig.useBigInt if this connection should convert all received integers to native BigInt numbers.\n   * @param {CreateResponseHandler} createResponseHandler Function which creates the response handler\n   * @param {Logger} log the logger\n   * @param {OnProtocolError} onProtocolError handles protocol errors\n   */\n  function BoltProtocol(server, chunker, _a, createResponseHandler, log, onProtocolError) {\n    var _b = _a === void 0 ? {} : _a,\n        disableLosslessIntegers = _b.disableLosslessIntegers,\n        useBigInt = _b.useBigInt;\n\n    if (createResponseHandler === void 0) {\n      createResponseHandler = function () {\n        return null;\n      };\n    }\n\n    this._server = server || {};\n    this._chunker = chunker;\n    this._packer = this._createPacker(chunker);\n    this._unpacker = this._createUnpacker(disableLosslessIntegers, useBigInt);\n    this._responseHandler = createResponseHandler(this);\n    this._log = log;\n    this._onProtocolError = onProtocolError;\n    this._fatalError = null;\n  }\n\n  Object.defineProperty(BoltProtocol.prototype, \"version\", {\n    /**\n     * Returns the numerical version identifier for this protocol\n     */\n    get: function () {\n      return BOLT_PROTOCOL_V1;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Get the packer.\n   * @return {Packer} the protocol's packer.\n   */\n\n  BoltProtocol.prototype.packer = function () {\n    return this._packer;\n  };\n  /**\n   * Get the unpacker.\n   * @return {Unpacker} the protocol's unpacker.\n   */\n\n\n  BoltProtocol.prototype.unpacker = function () {\n    return this._unpacker;\n  };\n  /**\n   * Transform metadata received in SUCCESS message before it is passed to the handler.\n   * @param {Object} metadata the received metadata.\n   * @return {Object} transformed metadata.\n   */\n\n\n  BoltProtocol.prototype.transformMetadata = function (metadata) {\n    return metadata;\n  };\n  /**\n   * Perform initialization and authentication of the underlying connection.\n   * @param {Object} param\n   * @param {string} param.userAgent the user agent.\n   * @param {Object} param.authToken the authentication token.\n   * @param {function(err: Error)} param.onError the callback to invoke on error.\n   * @param {function()} param.onComplete the callback to invoke on completion.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.initialize = function (_a) {\n    var _this = this;\n\n    var _b = _a === void 0 ? {} : _a,\n        userAgent = _b.userAgent,\n        authToken = _b.authToken,\n        onError = _b.onError,\n        onComplete = _b.onComplete;\n\n    var observer = new stream_observers_1.LoginObserver({\n      onError: function (error) {\n        return _this._onLoginError(error, onError);\n      },\n      onCompleted: function (metadata) {\n        return _this._onLoginCompleted(metadata, onComplete);\n      }\n    });\n    this.write(request_message_1.default.init(userAgent, authToken), observer, true);\n    return observer;\n  };\n  /**\n   * Perform protocol related operations for closing this connection\n   */\n\n\n  BoltProtocol.prototype.prepareToClose = function () {// no need to notify the database in this protocol version\n  };\n  /**\n   * Begin an explicit transaction.\n   * @param {Object} param\n   * @param {Bookmark} param.bookmark the bookmark.\n   * @param {TxConfig} param.txConfig the configuration.\n   * @param {string} param.database the target database name.\n   * @param {string} param.mode the access mode.\n   * @param {string} param.impersonatedUser the impersonated user\n   * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n   * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n   * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n   * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.beginTransaction = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n        bookmark = _b.bookmark,\n        txConfig = _b.txConfig,\n        database = _b.database,\n        mode = _b.mode,\n        impersonatedUser = _b.impersonatedUser,\n        beforeError = _b.beforeError,\n        afterError = _b.afterError,\n        beforeComplete = _b.beforeComplete,\n        afterComplete = _b.afterComplete;\n\n    return this.run('BEGIN', bookmark ? bookmark.asBeginTransactionParameters() : {}, {\n      bookmark: bookmark,\n      txConfig: txConfig,\n      database: database,\n      mode: mode,\n      impersonatedUser: impersonatedUser,\n      beforeError: beforeError,\n      afterError: afterError,\n      beforeComplete: beforeComplete,\n      afterComplete: afterComplete,\n      flush: false\n    });\n  };\n  /**\n   * Commit the explicit transaction.\n   * @param {Object} param\n   * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n   * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n   * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n   * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.commitTransaction = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n        beforeError = _b.beforeError,\n        afterError = _b.afterError,\n        beforeComplete = _b.beforeComplete,\n        afterComplete = _b.afterComplete; // WRITE access mode is used as a place holder here, it has\n    // no effect on behaviour for Bolt V1 & V2\n\n\n    return this.run('COMMIT', {}, {\n      bookmark: Bookmark.empty(),\n      txConfig: TxConfig.empty(),\n      mode: ACCESS_MODE_WRITE,\n      beforeError: beforeError,\n      afterError: afterError,\n      beforeComplete: beforeComplete,\n      afterComplete: afterComplete\n    });\n  };\n  /**\n   * Rollback the explicit transaction.\n   * @param {Object} param\n   * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n   * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n   * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n   * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.rollbackTransaction = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n        beforeError = _b.beforeError,\n        afterError = _b.afterError,\n        beforeComplete = _b.beforeComplete,\n        afterComplete = _b.afterComplete; // WRITE access mode is used as a place holder here, it has\n    // no effect on behaviour for Bolt V1 & V2\n\n\n    return this.run('ROLLBACK', {}, {\n      bookmark: Bookmark.empty(),\n      txConfig: TxConfig.empty(),\n      mode: ACCESS_MODE_WRITE,\n      beforeError: beforeError,\n      afterError: afterError,\n      beforeComplete: beforeComplete,\n      afterComplete: afterComplete\n    });\n  };\n  /**\n   * Send a Cypher query through the underlying connection.\n   * @param {string} query the cypher query.\n   * @param {Object} parameters the query parameters.\n   * @param {Object} param\n   * @param {Bookmark} param.bookmark the bookmark.\n   * @param {TxConfig} param.txConfig the transaction configuration.\n   * @param {string} param.database the target database name.\n   * @param {string} param.impersonatedUser the impersonated user\n   * @param {string} param.mode the access mode.\n   * @param {function(keys: string[])} param.beforeKeys the callback to invoke before handling the keys.\n   * @param {function(keys: string[])} param.afterKeys the callback to invoke after handling the keys.\n   * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n   * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n   * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n   * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n   * @param {boolean} param.flush whether to flush the buffered messages.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.run = function (query, parameters, _a) {\n    var _b = _a === void 0 ? {} : _a,\n        bookmark = _b.bookmark,\n        txConfig = _b.txConfig,\n        database = _b.database,\n        mode = _b.mode,\n        impersonatedUser = _b.impersonatedUser,\n        beforeKeys = _b.beforeKeys,\n        afterKeys = _b.afterKeys,\n        beforeError = _b.beforeError,\n        afterError = _b.afterError,\n        beforeComplete = _b.beforeComplete,\n        afterComplete = _b.afterComplete,\n        _c = _b.flush,\n        flush = _c === void 0 ? true : _c;\n\n    var observer = new stream_observers_1.ResultStreamObserver({\n      server: this._server,\n      beforeKeys: beforeKeys,\n      afterKeys: afterKeys,\n      beforeError: beforeError,\n      afterError: afterError,\n      beforeComplete: beforeComplete,\n      afterComplete: afterComplete\n    }); // bookmark and mode are ignored in this version of the protocol\n\n    (0, bolt_protocol_util_1.assertTxConfigIsEmpty)(txConfig, this._onProtocolError, observer); // passing in a database name on this protocol version throws an error\n\n    (0, bolt_protocol_util_1.assertDatabaseIsEmpty)(database, this._onProtocolError, observer); // passing impersonated user on this protocol version throws an error\n\n    (0, bolt_protocol_util_1.assertImpersonatedUserIsEmpty)(impersonatedUser, this._onProtocolError, observer);\n    this.write(request_message_1.default.run(query, parameters), observer, false);\n    this.write(request_message_1.default.pullAll(), observer, flush);\n    return observer;\n  };\n\n  Object.defineProperty(BoltProtocol.prototype, \"currentFailure\", {\n    get: function () {\n      return this._responseHandler.currentFailure;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Send a RESET through the underlying connection.\n   * @param {Object} param\n   * @param {function(err: Error)} param.onError the callback to invoke on error.\n   * @param {function()} param.onComplete the callback to invoke on completion.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n  BoltProtocol.prototype.reset = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n        onError = _b.onError,\n        onComplete = _b.onComplete;\n\n    var observer = new stream_observers_1.ResetObserver({\n      onProtocolError: this._onProtocolError,\n      onError: onError,\n      onComplete: onComplete\n    });\n    this.write(request_message_1.default.reset(), observer, true);\n    return observer;\n  };\n\n  BoltProtocol.prototype._createPacker = function (chunker) {\n    return new packstream_1.v1.Packer(chunker);\n  };\n\n  BoltProtocol.prototype._createUnpacker = function (disableLosslessIntegers, useBigInt) {\n    return new packstream_1.v1.Unpacker(disableLosslessIntegers, useBigInt);\n  };\n  /**\n   * Write a message to the network channel.\n   * @param {RequestMessage} message the message to write.\n   * @param {StreamObserver} observer the response observer.\n   * @param {boolean} flush `true` if flush should happen after the message is written to the buffer.\n   */\n\n\n  BoltProtocol.prototype.write = function (message, observer, flush) {\n    var _this = this;\n\n    var queued = this.queueObserverIfProtocolIsNotBroken(observer);\n\n    if (queued) {\n      if (this._log.isDebugEnabled()) {\n        this._log.debug(\"C: \" + message);\n      }\n\n      this.packer().packStruct(message.signature, message.fields.map(function (field) {\n        return _this.packer().packable(field);\n      }));\n\n      this._chunker.messageBoundary();\n\n      if (flush) {\n        this._chunker.flush();\n      }\n    }\n  };\n  /**\n   * Notifies faltal erros to the observers and mark the protocol in the fatal error state.\n   * @param {Error} error The error\n   */\n\n\n  BoltProtocol.prototype.notifyFatalError = function (error) {\n    this._fatalError = error;\n    return this._responseHandler._notifyErrorToObservers(error);\n  };\n  /**\n   * Updates the the current observer with the next one on the queue.\n   */\n\n\n  BoltProtocol.prototype.updateCurrentObserver = function () {\n    return this._responseHandler._updateCurrentObserver();\n  };\n  /**\n   * Checks if exist an ongoing observable requests\n   * @return {boolean}\n   */\n\n\n  BoltProtocol.prototype.hasOngoingObservableRequests = function () {\n    return this._responseHandler.hasOngoingObservableRequests();\n  };\n  /**\n   * Enqueue the observer if the protocol is not broken.\n   * In case it's broken, the observer will be notified about the error.\n   *\n   * @param {StreamObserver} observer The observer\n   * @returns {boolean} if it was queued\n   */\n\n\n  BoltProtocol.prototype.queueObserverIfProtocolIsNotBroken = function (observer) {\n    if (this.isBroken()) {\n      this.notifyFatalErrorToObserver(observer);\n      return false;\n    }\n\n    return this._responseHandler._queueObserver(observer);\n  };\n  /**\n   * Veritfy the protocol is not broken.\n   * @returns {boolean}\n   */\n\n\n  BoltProtocol.prototype.isBroken = function () {\n    return !!this._fatalError;\n  };\n  /**\n   * Notifies the current fatal error to the observer\n   *\n   * @param {StreamObserver} observer The observer\n   */\n\n\n  BoltProtocol.prototype.notifyFatalErrorToObserver = function (observer) {\n    if (observer && observer.onError) {\n      observer.onError(this._fatalError);\n    }\n  };\n  /**\n   * Reset current failure on the observable response handler to null.\n   */\n\n\n  BoltProtocol.prototype.resetFailure = function () {\n    this._responseHandler._resetFailure();\n  };\n\n  BoltProtocol.prototype._onLoginCompleted = function (metadata, onCompleted) {\n    if (metadata) {\n      var serverVersion = metadata.server;\n\n      if (!this._server.version) {\n        this._server.version = serverVersion;\n      }\n    }\n\n    if (onCompleted) {\n      onCompleted(metadata);\n    }\n  };\n\n  BoltProtocol.prototype._onLoginError = function (error, onError) {\n    this._onProtocolError(error.message);\n\n    if (onError) {\n      onError(error);\n    }\n  };\n\n  return BoltProtocol;\n}();\n\nexports.default = BoltProtocol;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","bolt_protocol_util_1","require","packstream_1","request_message_1","stream_observers_1","neo4j_driver_core_1","Bookmark","internal","bookmark","_a","constants","ACCESS_MODE_WRITE","BOLT_PROTOCOL_V1","Logger","logger","TxConfig","txConfig","BoltProtocol","server","chunker","createResponseHandler","log","onProtocolError","_b","disableLosslessIntegers","useBigInt","_server","_chunker","_packer","_createPacker","_unpacker","_createUnpacker","_responseHandler","_log","_onProtocolError","_fatalError","prototype","get","enumerable","configurable","packer","unpacker","transformMetadata","metadata","initialize","_this","userAgent","authToken","onError","onComplete","observer","LoginObserver","error","_onLoginError","onCompleted","_onLoginCompleted","write","default","init","prepareToClose","beginTransaction","database","mode","impersonatedUser","beforeError","afterError","beforeComplete","afterComplete","run","asBeginTransactionParameters","flush","commitTransaction","empty","rollbackTransaction","query","parameters","beforeKeys","afterKeys","_c","ResultStreamObserver","assertTxConfigIsEmpty","assertDatabaseIsEmpty","assertImpersonatedUserIsEmpty","pullAll","currentFailure","reset","ResetObserver","v1","Packer","Unpacker","message","queued","queueObserverIfProtocolIsNotBroken","isDebugEnabled","debug","packStruct","signature","fields","map","field","packable","messageBoundary","notifyFatalError","_notifyErrorToObservers","updateCurrentObserver","_updateCurrentObserver","hasOngoingObservableRequests","isBroken","notifyFatalErrorToObserver","_queueObserver","resetFailure","_resetFailure","serverVersion","version"],"sources":["/Users/zack/src/gene3/node_modules/neo4j-driver-bolt-connection/lib/bolt/bolt-protocol-v1.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar bolt_protocol_util_1 = require(\"./bolt-protocol-util\");\nvar packstream_1 = require(\"../packstream\");\nvar request_message_1 = __importDefault(require(\"./request-message\"));\nvar stream_observers_1 = require(\"./stream-observers\");\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\nvar Bookmark = neo4j_driver_core_1.internal.bookmark.Bookmark, _a = neo4j_driver_core_1.internal.constants, ACCESS_MODE_WRITE = _a.ACCESS_MODE_WRITE, BOLT_PROTOCOL_V1 = _a.BOLT_PROTOCOL_V1, Logger = neo4j_driver_core_1.internal.logger.Logger, TxConfig = neo4j_driver_core_1.internal.txConfig.TxConfig;\nvar BoltProtocol = /** @class */ (function () {\n    /**\n     * @callback CreateResponseHandler Creates the response handler\n     * @param {BoltProtocol} protocol The bolt protocol\n     * @returns {ResponseHandler} The response handler\n     */\n    /**\n     * @callback OnProtocolError Handles protocol error\n     * @param {string} error The description\n     */\n    /**\n     * @constructor\n     * @param {Object} server the server informatio.\n     * @param {Chunker} chunker the chunker.\n     * @param {Object} packstreamConfig Packstream configuration\n     * @param {boolean} packstreamConfig.disableLosslessIntegers if this connection should convert all received integers to native JS numbers.\n     * @param {boolean} packstreamConfig.useBigInt if this connection should convert all received integers to native BigInt numbers.\n     * @param {CreateResponseHandler} createResponseHandler Function which creates the response handler\n     * @param {Logger} log the logger\n     * @param {OnProtocolError} onProtocolError handles protocol errors\n     */\n    function BoltProtocol(server, chunker, _a, createResponseHandler, log, onProtocolError) {\n        var _b = _a === void 0 ? {} : _a, disableLosslessIntegers = _b.disableLosslessIntegers, useBigInt = _b.useBigInt;\n        if (createResponseHandler === void 0) { createResponseHandler = function () { return null; }; }\n        this._server = server || {};\n        this._chunker = chunker;\n        this._packer = this._createPacker(chunker);\n        this._unpacker = this._createUnpacker(disableLosslessIntegers, useBigInt);\n        this._responseHandler = createResponseHandler(this);\n        this._log = log;\n        this._onProtocolError = onProtocolError;\n        this._fatalError = null;\n    }\n    Object.defineProperty(BoltProtocol.prototype, \"version\", {\n        /**\n         * Returns the numerical version identifier for this protocol\n         */\n        get: function () {\n            return BOLT_PROTOCOL_V1;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Get the packer.\n     * @return {Packer} the protocol's packer.\n     */\n    BoltProtocol.prototype.packer = function () {\n        return this._packer;\n    };\n    /**\n     * Get the unpacker.\n     * @return {Unpacker} the protocol's unpacker.\n     */\n    BoltProtocol.prototype.unpacker = function () {\n        return this._unpacker;\n    };\n    /**\n     * Transform metadata received in SUCCESS message before it is passed to the handler.\n     * @param {Object} metadata the received metadata.\n     * @return {Object} transformed metadata.\n     */\n    BoltProtocol.prototype.transformMetadata = function (metadata) {\n        return metadata;\n    };\n    /**\n     * Perform initialization and authentication of the underlying connection.\n     * @param {Object} param\n     * @param {string} param.userAgent the user agent.\n     * @param {Object} param.authToken the authentication token.\n     * @param {function(err: Error)} param.onError the callback to invoke on error.\n     * @param {function()} param.onComplete the callback to invoke on completion.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.initialize = function (_a) {\n        var _this = this;\n        var _b = _a === void 0 ? {} : _a, userAgent = _b.userAgent, authToken = _b.authToken, onError = _b.onError, onComplete = _b.onComplete;\n        var observer = new stream_observers_1.LoginObserver({\n            onError: function (error) { return _this._onLoginError(error, onError); },\n            onCompleted: function (metadata) { return _this._onLoginCompleted(metadata, onComplete); }\n        });\n        this.write(request_message_1.default.init(userAgent, authToken), observer, true);\n        return observer;\n    };\n    /**\n     * Perform protocol related operations for closing this connection\n     */\n    BoltProtocol.prototype.prepareToClose = function () {\n        // no need to notify the database in this protocol version\n    };\n    /**\n     * Begin an explicit transaction.\n     * @param {Object} param\n     * @param {Bookmark} param.bookmark the bookmark.\n     * @param {TxConfig} param.txConfig the configuration.\n     * @param {string} param.database the target database name.\n     * @param {string} param.mode the access mode.\n     * @param {string} param.impersonatedUser the impersonated user\n     * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n     * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n     * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n     * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.beginTransaction = function (_a) {\n        var _b = _a === void 0 ? {} : _a, bookmark = _b.bookmark, txConfig = _b.txConfig, database = _b.database, mode = _b.mode, impersonatedUser = _b.impersonatedUser, beforeError = _b.beforeError, afterError = _b.afterError, beforeComplete = _b.beforeComplete, afterComplete = _b.afterComplete;\n        return this.run('BEGIN', bookmark ? bookmark.asBeginTransactionParameters() : {}, {\n            bookmark: bookmark,\n            txConfig: txConfig,\n            database: database,\n            mode: mode,\n            impersonatedUser: impersonatedUser,\n            beforeError: beforeError,\n            afterError: afterError,\n            beforeComplete: beforeComplete,\n            afterComplete: afterComplete,\n            flush: false\n        });\n    };\n    /**\n     * Commit the explicit transaction.\n     * @param {Object} param\n     * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n     * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n     * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n     * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.commitTransaction = function (_a) {\n        var _b = _a === void 0 ? {} : _a, beforeError = _b.beforeError, afterError = _b.afterError, beforeComplete = _b.beforeComplete, afterComplete = _b.afterComplete;\n        // WRITE access mode is used as a place holder here, it has\n        // no effect on behaviour for Bolt V1 & V2\n        return this.run('COMMIT', {}, {\n            bookmark: Bookmark.empty(),\n            txConfig: TxConfig.empty(),\n            mode: ACCESS_MODE_WRITE,\n            beforeError: beforeError,\n            afterError: afterError,\n            beforeComplete: beforeComplete,\n            afterComplete: afterComplete\n        });\n    };\n    /**\n     * Rollback the explicit transaction.\n     * @param {Object} param\n     * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n     * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n     * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n     * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.rollbackTransaction = function (_a) {\n        var _b = _a === void 0 ? {} : _a, beforeError = _b.beforeError, afterError = _b.afterError, beforeComplete = _b.beforeComplete, afterComplete = _b.afterComplete;\n        // WRITE access mode is used as a place holder here, it has\n        // no effect on behaviour for Bolt V1 & V2\n        return this.run('ROLLBACK', {}, {\n            bookmark: Bookmark.empty(),\n            txConfig: TxConfig.empty(),\n            mode: ACCESS_MODE_WRITE,\n            beforeError: beforeError,\n            afterError: afterError,\n            beforeComplete: beforeComplete,\n            afterComplete: afterComplete\n        });\n    };\n    /**\n     * Send a Cypher query through the underlying connection.\n     * @param {string} query the cypher query.\n     * @param {Object} parameters the query parameters.\n     * @param {Object} param\n     * @param {Bookmark} param.bookmark the bookmark.\n     * @param {TxConfig} param.txConfig the transaction configuration.\n     * @param {string} param.database the target database name.\n     * @param {string} param.impersonatedUser the impersonated user\n     * @param {string} param.mode the access mode.\n     * @param {function(keys: string[])} param.beforeKeys the callback to invoke before handling the keys.\n     * @param {function(keys: string[])} param.afterKeys the callback to invoke after handling the keys.\n     * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n     * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n     * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n     * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n     * @param {boolean} param.flush whether to flush the buffered messages.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.run = function (query, parameters, _a) {\n        var _b = _a === void 0 ? {} : _a, bookmark = _b.bookmark, txConfig = _b.txConfig, database = _b.database, mode = _b.mode, impersonatedUser = _b.impersonatedUser, beforeKeys = _b.beforeKeys, afterKeys = _b.afterKeys, beforeError = _b.beforeError, afterError = _b.afterError, beforeComplete = _b.beforeComplete, afterComplete = _b.afterComplete, _c = _b.flush, flush = _c === void 0 ? true : _c;\n        var observer = new stream_observers_1.ResultStreamObserver({\n            server: this._server,\n            beforeKeys: beforeKeys,\n            afterKeys: afterKeys,\n            beforeError: beforeError,\n            afterError: afterError,\n            beforeComplete: beforeComplete,\n            afterComplete: afterComplete\n        });\n        // bookmark and mode are ignored in this version of the protocol\n        (0, bolt_protocol_util_1.assertTxConfigIsEmpty)(txConfig, this._onProtocolError, observer);\n        // passing in a database name on this protocol version throws an error\n        (0, bolt_protocol_util_1.assertDatabaseIsEmpty)(database, this._onProtocolError, observer);\n        // passing impersonated user on this protocol version throws an error\n        (0, bolt_protocol_util_1.assertImpersonatedUserIsEmpty)(impersonatedUser, this._onProtocolError, observer);\n        this.write(request_message_1.default.run(query, parameters), observer, false);\n        this.write(request_message_1.default.pullAll(), observer, flush);\n        return observer;\n    };\n    Object.defineProperty(BoltProtocol.prototype, \"currentFailure\", {\n        get: function () {\n            return this._responseHandler.currentFailure;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Send a RESET through the underlying connection.\n     * @param {Object} param\n     * @param {function(err: Error)} param.onError the callback to invoke on error.\n     * @param {function()} param.onComplete the callback to invoke on completion.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.reset = function (_a) {\n        var _b = _a === void 0 ? {} : _a, onError = _b.onError, onComplete = _b.onComplete;\n        var observer = new stream_observers_1.ResetObserver({\n            onProtocolError: this._onProtocolError,\n            onError: onError,\n            onComplete: onComplete\n        });\n        this.write(request_message_1.default.reset(), observer, true);\n        return observer;\n    };\n    BoltProtocol.prototype._createPacker = function (chunker) {\n        return new packstream_1.v1.Packer(chunker);\n    };\n    BoltProtocol.prototype._createUnpacker = function (disableLosslessIntegers, useBigInt) {\n        return new packstream_1.v1.Unpacker(disableLosslessIntegers, useBigInt);\n    };\n    /**\n     * Write a message to the network channel.\n     * @param {RequestMessage} message the message to write.\n     * @param {StreamObserver} observer the response observer.\n     * @param {boolean} flush `true` if flush should happen after the message is written to the buffer.\n     */\n    BoltProtocol.prototype.write = function (message, observer, flush) {\n        var _this = this;\n        var queued = this.queueObserverIfProtocolIsNotBroken(observer);\n        if (queued) {\n            if (this._log.isDebugEnabled()) {\n                this._log.debug(\"C: \" + message);\n            }\n            this.packer().packStruct(message.signature, message.fields.map(function (field) { return _this.packer().packable(field); }));\n            this._chunker.messageBoundary();\n            if (flush) {\n                this._chunker.flush();\n            }\n        }\n    };\n    /**\n     * Notifies faltal erros to the observers and mark the protocol in the fatal error state.\n     * @param {Error} error The error\n     */\n    BoltProtocol.prototype.notifyFatalError = function (error) {\n        this._fatalError = error;\n        return this._responseHandler._notifyErrorToObservers(error);\n    };\n    /**\n     * Updates the the current observer with the next one on the queue.\n     */\n    BoltProtocol.prototype.updateCurrentObserver = function () {\n        return this._responseHandler._updateCurrentObserver();\n    };\n    /**\n     * Checks if exist an ongoing observable requests\n     * @return {boolean}\n     */\n    BoltProtocol.prototype.hasOngoingObservableRequests = function () {\n        return this._responseHandler.hasOngoingObservableRequests();\n    };\n    /**\n     * Enqueue the observer if the protocol is not broken.\n     * In case it's broken, the observer will be notified about the error.\n     *\n     * @param {StreamObserver} observer The observer\n     * @returns {boolean} if it was queued\n     */\n    BoltProtocol.prototype.queueObserverIfProtocolIsNotBroken = function (observer) {\n        if (this.isBroken()) {\n            this.notifyFatalErrorToObserver(observer);\n            return false;\n        }\n        return this._responseHandler._queueObserver(observer);\n    };\n    /**\n     * Veritfy the protocol is not broken.\n     * @returns {boolean}\n     */\n    BoltProtocol.prototype.isBroken = function () {\n        return !!this._fatalError;\n    };\n    /**\n     * Notifies the current fatal error to the observer\n     *\n     * @param {StreamObserver} observer The observer\n     */\n    BoltProtocol.prototype.notifyFatalErrorToObserver = function (observer) {\n        if (observer && observer.onError) {\n            observer.onError(this._fatalError);\n        }\n    };\n    /**\n     * Reset current failure on the observable response handler to null.\n     */\n    BoltProtocol.prototype.resetFailure = function () {\n        this._responseHandler._resetFailure();\n    };\n    BoltProtocol.prototype._onLoginCompleted = function (metadata, onCompleted) {\n        if (metadata) {\n            var serverVersion = metadata.server;\n            if (!this._server.version) {\n                this._server.version = serverVersion;\n            }\n        }\n        if (onCompleted) {\n            onCompleted(metadata);\n        }\n    };\n    BoltProtocol.prototype._onLoginError = function (error, onError) {\n        this._onProtocolError(error.message);\n        if (onError) {\n            onError(error);\n        }\n    };\n    return BoltProtocol;\n}());\nexports.default = BoltProtocol;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}